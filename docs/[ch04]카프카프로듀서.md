# 4장 카프카 프로듀서
- 프로듀서는 **키 값을 정해** 메시지를 **동일한 파티션으로 전송할 수 있다**.

## 4.1 콘솔 프로듀서로 메시지 보내기
## 4.2 자바와 파이썬을 이용한 프로듀서
### 4.2.1 메시지를 보내고 확인하지 않기
### 4.2.2 동기 전송
### 4.2.3 비동기 전송
## 4.3 프로듀서 활용 예제
## 4.4 프로듀서 주요 옵션
> **bootstrap.servers**  
> 카프카 클러스터 연결을 위한 호스트 및 포트  
> **acks**   
    > 0 일경우, 서버가 데이터를 받았는지 보장하지 않는다.  
    > 1일경우, 리더는 데이터를 기록하지만, 팔로워 전체가 기록되었는지는 확인하지 않는다.  
    > -1 일 or all 일경우, ISR의 팔로워로부터 데이터에대한 ack를 기다린다(데이터 무손실 보장)    
> **buffer.memory** : 서버로 데이터를 보내기전 잠시 대기할 수 있는 전체 메모리 바이트    
> compression.type : 압축  
> retries : 일시적인 오류로 인해 전송에 실패한 데이터를 다시 보낸다.  
> batch.size : 배치 크기 바이트 단위 조정  
> linger.ms : 배치형태의 메시지를 보내기 전에 추가적인 메시지들을 위해 기다리는 시간 조정  
> max.request.size : 프로듀서가 보낼 수 잇는 최대 메시지 바이트 사이즈 (기본 1MB)  

## 4.5 메시지 전송 방법
### 4.5.1 메시지 손실 가능성이 높지만 빠른 전송이 필요한 경우
- acks=0
### 4.5.2 메시지 손실 가능성이 적고 적당한 속도의 전송이 핋요한 경우
- acks=1
- 오직 리더만 데이터를 기록하므로, 만약 리더가 고장이 난다면 데이터가 유실될 수 있다.
- 특별한 경우가 아니라면 속도와 안정성을 확보할 수 있는 acks=1로 사용하는 방법을 추천한다.
### 4.5.3 전송 속도는 느리지만 메시지 손실이 없어야 하는경우
- acks=all

#### 프로듀서의 acks=all, 브로커 min.insync.replicas=1
- min.insync.replicas
  - 최소 리플리케이션 팩터를 지정하는 옵션
- 리플리케이션이 1일경우, acks=all 이더라도 acks=1 과 같이 동작한다.(리더만 저장)

#### 프로듀서의 acks=all, 브로커 min.insync.replicas=2
- acks를 서버에 전송하기 전에 **최소 2개의 리플리케이션을 유지하고 확인**한다4.

#### 프로듀서의 acks=all, 브로커 min.insync.replicas=3
- 브로커가 3개일경우, 브로커 하나가 종료되면 모든 브로커가 전체 장애가 발생한다.
  - 최소 리플리케이션이 3개이므로, 하나라도 sync가 맞지 않으면 오류

> **카프카에서는 acks=all 일경우, min.insync.replicas=2 로, 레플리케이션 팩터는 3으로 설정하기를 권장하고 있다.**